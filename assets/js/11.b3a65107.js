(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{356:function(v,_,e){v.exports=e.p+"assets/img/page-render.dd806c52.png"},378:function(v,_,e){"use strict";e.r(_);var t=e(42),a=Object(t.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"reflow-and-repaint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reflow-and-repaint"}},[v._v("#")]),v._v(" Reflow and Repaint")]),v._v(" "),t("h2",{attrs:{id:"瀏覽器的渲染步驟"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#瀏覽器的渲染步驟"}},[v._v("#")]),v._v(" 瀏覽器的渲染步驟")]),v._v(" "),t("p",[t("img",{attrs:{src:e(356),alt:"瀏覽器的渲染步驟"}})]),v._v(" "),t("p",[v._v("上圖是瀏覽器解析網頁的示意圖，為方便理解，簡單拆解成幾個步驟：")]),v._v(" "),t("ol",[t("li",[v._v("從 "),t("code",[v._v("HTML")]),v._v(" 檔解析出 "),t("code",[v._v("DOM Tree")])]),v._v(" "),t("li",[v._v("從 "),t("code",[v._v("CSS")]),v._v(" 檔解析出 "),t("code",[v._v("CSSOM Tree")])]),v._v(" "),t("li",[v._v("兩者疊加後產生 "),t("code",[v._v("Render Tree")])]),v._v(" "),t("li",[t("code",[v._v("Reflow")]),v._v("：計算出 "),t("code",[v._v("Render Tree")]),v._v(" 上各個元素的物理屬性，如位置、大小、及是否看得見（visible）")]),v._v(" "),t("li",[t("code",[v._v("Repaint")]),v._v("：將計算結果轉為實際的像素，畫到畫面上")])]),v._v(" "),t("h2",{attrs:{id:"reflow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reflow"}},[v._v("#")]),v._v(" Reflow")]),v._v(" "),t("p",[v._v("這個步驟會由 "),t("code",[v._v("Render Tree")]),v._v(" 的根結點出發，逐步計算出每一個元素的位置、大小，以及是否被其他元素遮擋等屬性，需要耗費大量的運算資源；也因為是要計算出這些屬性，只要是有可能牽扯到下面屬性的操作，都會觸發 "),t("code",[v._v("Reflow")])]),v._v(" "),t("ul",[t("li",[v._v("設定 CSS 屬性\n"),t("ul",[t("li",[v._v("大小："),t("code",[v._v("width")]),v._v("、"),t("code",[v._v("height")])]),v._v(" "),t("li",[v._v("浮動："),t("code",[v._v("float")])]),v._v(" "),t("li",[v._v("定位："),t("code",[v._v("position")])])])]),v._v(" "),t("li",[v._v("使用者進行互動\n"),t("ul",[t("li",[v._v("調整瀏覽器視窗大小")]),v._v(" "),t("li",[v._v("輸入框的內容變更")])])]),v._v(" "),t("li",[v._v("JavaScript\n"),t("ul",[t("li",[v._v("DOM 操作")]),v._v(" "),t("li",[v._v("動態載入 CSS 樣式表")]),v._v(" "),t("li",[v._v("取得元素的大小數值")])])])]),v._v(" "),t("p",[v._v("其中 "),t("strong",[v._v("取得元素的大小數值")]),v._v(" 較為特別，可以查看參考文章")]),v._v(" "),t("h2",{attrs:{id:"repaint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#repaint"}},[v._v("#")]),v._v(" Repaint")]),v._v(" "),t("p",[v._v("經過了 "),t("code",[v._v("Reflow")]),v._v(" 的計算，"),t("code",[v._v("Repaint")]),v._v(" 的任務是要把計算結果轉換成螢幕上的實際像素顯示。相比於 "),t("code",[v._v("Reflow")]),v._v(" ，"),t("code",[v._v("Repaint")]),v._v(" 就單純多了，任何可見元素的樣式變更，最後都必然需要重新繪製到畫面上")]),v._v(" "),t("h2",{attrs:{id:"瀏覽器效能優化規則"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#瀏覽器效能優化規則"}},[v._v("#")]),v._v(" 瀏覽器效能優化規則")]),v._v(" "),t("p",[v._v("瀏覽器開發者也知道這些渲染步驟很吃效能，所以前輩們在實作時便早已寫好了優化規則：")]),v._v(" "),t("p",[v._v("如同 "),t("code",[v._v("Reflow")]),v._v(" 段落提到的，由於 "),t("code",[v._v("Reflow")]),v._v(" 極耗效能，瀏覽器會 "),t("strong",[v._v("自動批次執行")]),v._v("。\n當 DOM 元素的樣式被修改觸發前述步驟時，瀏覽器會依據修改的屬性而 "),t("strong",[v._v("自動省略")]),v._v(" 不需要的步驟，重新渲染頁面。")]),v._v(" "),t("ul",[t("li",[v._v("修改 "),t("code",[v._v("width")]),v._v(" → "),t("code",[v._v("Reflow")]),v._v(" → "),t("code",[v._v("Repaint")])]),v._v(" "),t("li",[v._v("修改 "),t("code",[v._v("color")]),v._v(" → "),t("code",[v._v("Repaint")])])]),v._v(" "),t("h2",{attrs:{id:"拯救網頁效能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拯救網頁效能"}},[v._v("#")]),v._v(" 拯救網頁效能")]),v._v(" "),t("h3",{attrs:{id:"屬性替換"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#屬性替換"}},[v._v("#")]),v._v(" 屬性替換")]),v._v(" "),t("p",[v._v("將 "),t("code",[v._v("物理屬性")]),v._v(" 的變化，換成相似的其他屬性變化，來節省 "),t("code",[v._v("Reflow")]),v._v(" 的效能開銷：")]),v._v(" "),t("ul",[t("li",[v._v("用 "),t("code",[v._v("translate")]),v._v(" 取代 "),t("code",[v._v("top")]),v._v(" 等定位屬性")]),v._v(" "),t("li",[v._v("由於表格的物理屬性會互相影響，容易改一格就整張表 "),t("code",[v._v("Reflow")]),v._v("，可以的話請不要用 "),t("code",[v._v("table")]),v._v(" 排版")])]),v._v(" "),t("h3",{attrs:{id:"批次修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#批次修改"}},[v._v("#")]),v._v(" 批次修改")]),v._v(" "),t("p",[v._v("當需要用 JavaScript 修改樣式時，盡量讓樣式能批次生效：")]),v._v(" "),t("ul",[t("li",[v._v("替換 class name 或修改 "),t("code",[v._v("cssText")]),v._v("，而不是逐個設定 "),t("code",[v._v("style")]),v._v(" 屬性")]),v._v(" "),t("li",[v._v("透過 "),t("code",[v._v("el.cloneNode()")]),v._v(" 複製一份 "),t("code",[v._v("DOM")]),v._v("，在上面修改樣式後，在替換原本的 "),t("code",[v._v("DOM")])]),v._v(" "),t("li",[v._v("透過 "),t("code",[v._v("document.createDocumentFragment()")]),v._v(" 建立 Document Fragments，編輯 "),t("code",[v._v("DOM")]),v._v(" 後再加回主 "),t("code",[v._v("DOM Tree")]),v._v(" 中")])]),v._v(" "),t("h3",{attrs:{id:"減少影響範圍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#減少影響範圍"}},[v._v("#")]),v._v(" 減少影響範圍")]),v._v(" "),t("p",[v._v("如果 "),t("code",[v._v("Reflow")]),v._v(" 是避免不了的，那就只能減少影響範圍了：")]),v._v(" "),t("ul",[t("li",[v._v("盡量避免 "),t("code",[v._v("DOM")]),v._v("、"),t("code",[v._v("CSSOM")]),v._v(" Tree 的層級過深，加快 "),t("code",[v._v("Reflow")]),v._v(" 的計算")]),v._v(" "),t("li",[v._v("程式取得元素物理屬性時，將結果 "),t("strong",[v._v("暫存起來")]),v._v("，不要重複觸發計算")]),v._v(" "),t("li",[v._v("改動頻繁的地方 建立單獨的圖層")])]),v._v(" "),t("h2",{attrs:{id:"參考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#參考"}},[v._v("#")]),v._v(" 參考")]),v._v(" "),t("p",[t("a",{attrs:{href:"https://ithelp.ithome.com.tw/articles/10217427",target:"_blank",rel:"noopener noreferrer"}},[v._v("Reflow 及 Repaint 是什麼"),t("OutboundLink")],1)])])}),[],!1,null,null,null);_.default=a.exports}}]);